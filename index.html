<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Get Annie Chan</title>
  <link rel="icon" href="favicon.png" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="stylesheet" href="style.css" />

  <!-- Send iOS 9 and lower to UltraLegacy, 10‚Äì14 to Legacy -->
  <script>
  (function() {
    try {
      var ua = navigator.userAgent || "";
      var m  = ua.match(/(CPU iPhone|CPU OS|iPad).*OS (\d+)_/i);
      var ios = m ? parseInt(m[2], 10) : null;
      if (ios && ios <= 9) {
        window.location.replace("/UltraLegacy/");
      } else if (ios && ios <= 14) {
        window.location.replace("/Legacy/");
      }
    } catch(e) {}
  })();
  </script>
</head>

<body oncontextmenu="return false;">
  <div class="card">
    <h1 class="site-title" id="title">
      <span class="chunk">Welcome</span>
      <span class="chunk">to</span>
      <span class="chunk">Get</span>
      <span class="chunk" id="annieName">Annie</span>
      <span class="chunk">Chan</span>
      <img src="annie_thumb.jpg" alt="Annie Icon" class="annie-icon" id="annieIcon" draggable="false" oncontextmenu="return false" />
    </h1>

    <div class="primary-actions">
      <a id="downloadLink" href="annie_chan.png">
        <button class="button" id="getAnnieBtn">Get Annie Chan</button>
      </a>

      <a href="/extras" class="extras-link">Extras</a>

      <button class="button" id="creditsBtn">Credits & Fair Use</button>
    </div>
  </div>

  <!-- Credits Modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="credits-modal" role="dialog" aria-modal="true">
      <button class="close-x" id="closeX" aria-label="Close">‚úï</button>
      <h2>Credits & Fair Use</h2>
      <p>(Website by GAC) ‚Äì Published by GAC / For Entertainment Purposes Only</p>
      <p>Maintained & Updated by GAC Web Division</p>
      <p id="versionLine">Version 3.1.1 ‚Äì YEAR Edition ‚Äì Produced at GAC Web Division</p>
      <p>"This artwork speaks to me, and the rest of the world should see it. Support the artist."</p>
      <p>‚ÄúGet Annie Chan‚Äù is a tribute project. GAC does not claim ownership of any artwork used. All rights belong to their respective creators.</p>
      <p class="artist-line">
        <strong>Featuring artwork from ctchrysler</strong>
        <a href="https://www.deviantart.com/dctb/art/Annie-Chan-579680748" target="_blank" class="annie-link">‚ÄúAnnie Chan‚Äù</a> ‚Äî Annie Mei cosplaying as
        <a href="https://twitter.com/shunyayamashita" target="_blank" class="annie-link" style="text-decoration: underline;">Shunya Yamashita‚Äôs</a> Sera-chan.<br>
        <em>It‚Äôs been a while since I‚Äôve drawn her in a sailor outfit!</em>
      </p>
      <p><strong>Fair Use Disclaimer:</strong> This site falls under fair use as a non-commercial, transformative tribute. If the original creator wishes for its removal, it will be taken down immediately.</p>
      <p id="copyrightLine">¬© YEAR GAC</p>
      <p>Peace and Love</p>
      <button class="done-button" id="doneBtn">Done</button>
    </div>
  </div>

  <!-- Popups -->
  <div class="popup" id="popupJune30">
    <h2 id="juneTitle">üéâ Years of Annie</h2>
    <p>June 30, 2011 ‚Äì Thank you CT.</p>
    <button onclick="document.getElementById('popupJune30').classList.remove('show')">Close</button>
  </div>

  <div class="popup" id="popupDec22">
    <h2 id="decTitle">üéâ Years of Annie Chan</h2>
    <p>December 22, 2015 ‚Äì Thank you CT.</p>
    <button onclick="document.getElementById('popupDec22').classList.remove('show')">Close</button>
  </div>

  <script>
    // ---------- helpers ----------
    function getIOSMajor() {
      try {
        var ua = navigator.userAgent || "";
        var m = ua.match(/(CPU iPhone|CPU OS|iPad).*OS (\d+)_/i);
        return m ? parseInt(m[2], 10) : null;
      } catch (e) { return null; }
    }

    // ---------- Auto-year for version + copyright ----------
    (function() {
      var y = new Date().getFullYear();
      var v = document.getElementById('versionLine');
      var c = document.getElementById('copyrightLine');
      if (v) v.textContent = 'Version 3.1 ‚Äì ' + y + ' Edition ‚Äì Produced at GAC Web Division';
      if (c) c.textContent = '¬© ' + y + ' GAC';
    })();

    // ---------- Credits modal logic ----------
    var overlay = document.getElementById('overlay');
    var creditsBtn = document.getElementById('creditsBtn');
    var closeX = document.getElementById('closeX');
    var doneBtn = document.getElementById('doneBtn');

    function openCredits(){
      overlay.classList.add('show');
      document.body.classList.add('no-scroll');
      overlay.setAttribute('aria-hidden','false');
    }
    function closeCredits(){
      overlay.classList.remove('show');
      document.body.classList.remove('no-scroll');
      overlay.setAttribute('aria-hidden','true');
    }

    creditsBtn.addEventListener('click', function(e){
      e.stopPropagation();
      openCredits();
    });
    closeX.addEventListener('click', closeCredits);
    doneBtn.addEventListener('click', closeCredits);
    overlay.addEventListener('click', function(e){
      if(e.target === overlay) closeCredits();
    });

    // Auto-open credits when coming from /info redirect
    if (location.hash === '#info') {
      openCredits();
    }

    // ---------- Dynamic popup titles ----------
    var year = new Date().getFullYear();
    document.getElementById('juneTitle').textContent = 'üéâ ' + (year - 2011) + ' Years of Annie';
    document.getElementById('decTitle').textContent  = 'üéâ ' + (year - 2015) + ' Years of Annie Chan';

    // ---------- Date checks ----------
    var today = new Date();
    var isJune30   = today.getMonth() === 5 && today.getDate() === 30;
    var isDecAnniv = today.getMonth() === 11 && (today.getDate() === 22 || today.getDate() === 23);

    if (isJune30)   document.getElementById('popupJune30').classList.add('show');
    if (isDecAnniv) document.getElementById('popupDec22').classList.add('show');

    // ---------- Download behavior (kept as-is) ----------
    var getBtn = document.getElementById('getAnnieBtn');
    var dlLink = document.getElementById('downloadLink');

    if (isDecAnniv) {
      getBtn.classList.add('gold');
      getBtn.addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('popupDec22').classList.add('show');
        setTimeout(function() {
          var a = document.createElement('a');
          a.href = dlLink.getAttribute('href');
          a.download = 'annie_chan.png';
          document.body.appendChild(a); a.click(); a.remove();
        }, 900);
      });
    } else {
      dlLink.addEventListener('click', function(e) {
        var ios = getIOSMajor(); // reuse same detection
        if (!ios || ios >= 11) {
          e.preventDefault();
          var a = document.createElement('a');
          a.href = dlLink.getAttribute('href');
          a.download = 'annie_chan.png';
          document.body.appendChild(a); a.click(); a.remove();
        }
      });
    }

    // ---------- Easter eggs ----------
    var nameTaps = 0;
    var requiredTaps = year - 2011;
    document.getElementById('annieName').addEventListener('click', function() {
      nameTaps++;
      if (nameTaps === requiredTaps) {
        document.getElementById('popupJune30').classList.add('show');
        nameTaps = 0;
      }
    });

    var iconTaps = 0, refreshTimer;
    var icon = document.getElementById('annieIcon');
    icon.addEventListener('click', function() {
      iconTaps++;
      clearTimeout(refreshTimer);
      if (iconTaps === 10) {
        document.getElementById('popupDec22').classList.add('show');
        iconTaps = 0;
      } else {
        refreshTimer = setTimeout(function() {
          if (iconTaps === 1) location.reload();
          iconTaps = 0;
        }, 1100);
      }
    });

    // ----------  ----------
    (function () {
      var btn = document.getElementById('getAnnieBtn');
      if (!btn) return;

      var startX = 0, startY = 0;
      var tracking = false;
      var SWIPE_X = 70;   // distance left
      var MAX_Y = 35;     // ignore if too vertical

      function getPoint(e) {
        if (e.touches && e.touches.length) return e.touches[0];
        if (e.changedTouches && e.changedTouches.length) return e.changedTouches[0];
        return e;
      }

      function onStart(e) {
        var p = getPoint(e);
        startX = p.clientX;
        startY = p.clientY;
        tracking = true;
      }

      function onEnd(e) {
        if (!tracking) return;
        tracking = false;

        var p = getPoint(e);
        var dx = p.clientX - startX;
        var dy = p.clientY - startY;

        if (dx <= -SWIPE_X && Math.abs(dy) <= MAX_Y) {
          // stop normal click/download
          if (e && typeof e.preventDefault === "function") e.preventDefault();
          if (e && typeof e.stopPropagation === "function") e.stopPropagation();

          window.location.href = "/backlog";
        }
      }

      // Touch
      btn.addEventListener('touchstart', onStart, { passive: true });
      btn.addEventListener('touchend', onEnd, { passive: false });

      // Mouse (desktop drag)
      btn.addEventListener('mousedown', onStart);
      btn.addEventListener('mouseup', onEnd);

      // If cursor leaves while dragging, still decide
      btn.addEventListener('mouseleave', function (e) {
        if (tracking) onEnd(e);
      });
    })();
  </script>
</body>
</html>
