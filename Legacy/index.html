<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Get Annie Chan (Legacy)</title>
  <link rel="icon" href="/favicon.png" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  <!-- Normal legacy CSS (iOS 10–13) -->
  <link rel="stylesheet" href="style.css" />

  <!-- Ultra Legacy CSS (iOS 9 and below) -->
  <link id="ultraLegacyCSS" rel="stylesheet" href="style.css" disabled />

  <!-- Allow only iOS/iPadOS <=13 on Legacy; others go back to main -->
  <script>
  (function() {
    try {
      var ua = navigator.userAgent || "";
      var m = ua.match(/(CPU iPhone|CPU OS|iPad).*OS (\d+)_/i);
      var ios = m ? parseInt(m[2], 10) : null;
      if (!ios || ios >= 14) { window.location.replace("/"); }
      // Enable Ultra Legacy for iOS 9 and below
      if (ios && ios <= 9) {
        var l = document.getElementById('ultraLegacyCSS'); if (l) l.disabled = false;
        document.documentElement.setAttribute('data-ultra','1');
      }
    } catch(e) { window.location.replace("/"); }
  })();
  </script>
</head>
<body oncontextmenu="return false;">
  <div class="card">
    <h1 class="site-title" id="title">
      <span class="chunk">Welcome</span>
      <span class="chunk">to</span>
      <span class="chunk">Get</span>
      <span class="chunk" id="annieName">Annie</span>
      <span class="chunk">Chan</span>
      <img src="/annie_thumb.jpg" alt="Annie Icon" class="annie-icon" id="annieIcon" draggable="false" oncontextmenu="return false" />
    </h1>

    <div class="primary-actions">
      <a id="downloadLink" href="/annie_chan.png">
        <button class="button" id="getAnnieBtn">Get Annie Chan</button>
      </a>

      <a href="/extras" class="extras-link">Extras</a>

      <!-- Modal button for normal legacy -->
      <button class="button" id="creditsBtn">Credits & Fair Use</button>
      <!-- Link fallback for Ultra Legacy -->
      <a id="creditsBtnLink" href="credits_ultra.html" class="button" style="display:none">Credits &amp; Fair Use</a>
    </div>
  </div>

  <!-- Credits Modal (hidden in Ultra mode) -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="credits-modal" role="dialog" aria-modal="true">
      <button class="close-x" id="closeX" aria-label="Close">✕</button>
      <h2>Credits & Fair Use</h2>
      <p>(Website by GAC Legacy) – Published by GAC / For Entertainment Purposes Only</p>
      <p>Maintained & Updated by GAC Legacy Web Division</p>
      <p id="versionLine">Version 3.0 – YEAR Edition – Produced at GAC Web Division</p>
      <p>"This artwork speaks to me, and the rest of the world should see it. Support the artist."</p>
      <p>“Get Annie Chan” is a tribute project. GAC does not claim ownership of any artwork used. All rights belong to their respective creators.</p>
      <p class="artist-line">
        <strong>Featuring artwork from ctchrysler</strong>
        <a href="https://www.deviantart.com/dctb/art/Annie-Chan-579680748" target="_blank" class="annie-link">“Annie Chan”</a> — Annie Mei cosplaying as 
        <a href="https://twitter.com/shunyayamashita" target="_blank" class="annie-link" style="text-decoration: underline;">Shunya Yamashita’s</a> Sera-chan.<br>
        <em>It’s been a while since I’ve drawn her in a sailor outfit!</em>
      </p>
      <p><strong>Fair Use Disclaimer:</strong> This site falls under fair use as a non-commercial, transformative tribute. If the original creator wishes for its removal, it will be taken down immediately.</p>
      <p id="copyrightLine">© YEAR GAC</p>
      <p>Peace and Love</p>
      <button class="done-button" id="doneBtn">Done</button>
    </div>
  </div>

  <!-- Popups -->
  <div class="popup" id="popupJune30">
    <h2 id="juneTitle">🎉 Years of Annie</h2>
    <p>June 30, 2011 – Thank you CT.</p>
    <button onclick="document.getElementById('popupJune30').classList.remove('show')">Close</button>
  </div>

  <div class="popup" id="popupDec22">
    <h2 id="decTitle">🎉 Years of Annie Chan</h2>
    <p>December 22, 2015 – Thank you CT.</p>
    <button onclick="document.getElementById('popupDec22').classList.remove('show')">Close</button>
  </div>

  <script>
    // Auto-year
    (function(){
      var y = new Date().getFullYear();
      var v = document.getElementById('versionLine');
      var c = document.getElementById('copyrightLine');
      if (v) v.textContent = 'Version 3.0 – ' + y + ' Edition – Produced at GAC Web Division';
      if (c) c.textContent = '© ' + y + ' GAC';
    })();

    // Ultra mode swaps modal button for link
    (function(){
      if (document.documentElement.getAttribute('data-ultra') === '1') {
        var b = document.getElementById('creditsBtn');
        var l = document.getElementById('creditsBtnLink');
        if (b) b.style.display = 'none';
        if (l) l.style.display = 'inline-block';
      }
    })();

    // Modal logic (kept for iOS 10–13)
    (function(){
      if (document.documentElement.getAttribute('data-ultra') === '1') return;
      function addClass(el,c){ if (el.classList) el.classList.add(c); else el.className += ' ' + c; }
      function removeClass(el,c){ if (el.classList) el.classList.remove(c); else el.className = el.className.replace(c,''); }
      var overlay = document.getElementById('overlay');
      var creditsBtn = document.getElementById('creditsBtn');
      var closeX = document.getElementById('closeX');
      var doneBtn = document.getElementById('doneBtn');
      function openCredits(){ addClass(overlay,'show'); addClass(document.body,'no-scroll'); overlay.setAttribute('aria-hidden','false'); }
      function closeCredits(){ removeClass(overlay,'show'); removeClass(document.body,'no-scroll'); overlay.setAttribute('aria-hidden','true'); }
      creditsBtn && creditsBtn.addEventListener('click', function(e){ e.stopPropagation(); openCredits(); }, false);
      closeX && closeX.addEventListener('click', closeCredits, false);
      doneBtn && doneBtn.addEventListener('click', closeCredits, false);
      overlay && overlay.addEventListener('click', function(e){ if(e.target === overlay) closeCredits(); }, false);
    })();

    // Titles
    (function(){
      var year = new Date().getFullYear();
      document.getElementById('juneTitle').innerHTML = '🎉 ' + (year - 2011) + ' Years of Annie';
      document.getElementById('decTitle').innerHTML  = '🎉 ' + (year - 2015) + ' Years of Annie Chan';
    })();

    // Dates
    (function(){
      var today = new Date();
      var isJune30   = today.getMonth() === 5 && today.getDate() === 30;
      var isDecAnniv = today.getMonth() === 11 && (today.getDate() === 22 || today.getDate() === 23);
      if (isJune30)   document.getElementById('popupJune30').className += ' show';
      if (isDecAnniv) document.getElementById('popupDec22').className += ' show';
    })();

    // Download / gold button for Dec 22–23
    (function(){
      var today = new Date();
      var isDecAnniv = today.getMonth() === 11 && (today.getDate() === 22 || today.getDate() === 23);
      var getBtn = document.getElementById('getAnnieBtn');
      var dlLink = document.getElementById('downloadLink');
      if (isDecAnniv) {
        if (getBtn) getBtn.className += ' gold';
        getBtn && getBtn.addEventListener('click', function(e){
          e.preventDefault();
          var dec = document.getElementById('popupDec22'); if (dec) dec.className += ' show';
          setTimeout(function(){
            try{
              var a = document.createElement('a'); a.href = dlLink.getAttribute('href'); a.setAttribute('download','annie_chan.png');
              document.body.appendChild(a); a.click(); document.body.removeChild(a);
            }catch(err){ window.open(dlLink.getAttribute('href'), '_blank'); }
          }, 900);
        }, false);
      } else {
        dlLink && dlLink.addEventListener('click', function(e){
          try{
            e.preventDefault();
            var a = document.createElement('a'); a.href = dlLink.getAttribute('href'); a.setAttribute('download','annie_chan.png');
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
          }catch(err){ window.open(dlLink.getAttribute('href'), '_blank'); }
        }, false);
      }
    })();

    // ===== Ultra Legacy Easter eggs (iOS 9 and below) =====
    (function () {
      if (document.documentElement.getAttribute('data-ultra') !== '1') return;

      // Disable single-tap refresh
      var icon = document.getElementById('annieIcon');
      if (icon) icon.onclick = null;

      // Long-press on “Annie” for June popup
      var nameEl = document.getElementById('annieName');
      var pressTimer;
      if (nameEl) {
        nameEl.addEventListener('touchstart', function () {
          pressTimer = setTimeout(function () {
            var june = document.getElementById('popupJune30');
            if (june) june.className += ' show';
          }, 1200);
        }, false);
        nameEl.addEventListener('touchend', function () { clearTimeout(pressTimer); }, false);
        nameEl.addEventListener('touchmove', function () { clearTimeout(pressTimer); }, false);
      }

      // Triple-tap icon within 2s for Dec popup
      var taps = 0, windowTimer;
      if (icon) {
        icon.addEventListener('touchend', function () {
          taps++;
          clearTimeout(windowTimer);
          if (taps >= 3) {
            var dec = document.getElementById('popupDec22');
            if (dec) dec.className += ' show';
            taps = 0;
          } else {
            windowTimer = setTimeout(function(){ taps = 0; }, 2000);
          }
        }, false);
      }
    })();
  </script>
</body>
</html>
